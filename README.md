# JSON DB

Легковесная файловая JSON база данных с индексированием на основе B-деревьев и SQL-подобным интерфейсом запросов.

## Обзор

JSON DB — это простая, но мощная система базы данных, которая хранит документы в виде отдельных JSON-файлов и обеспечивает эффективные возможности запросов через B-Tree индексы. Она поддерживает SQL-подобный синтаксис запросов для обычных операций с базами данных, сохраняя при этом гибкость JSON-документов.

## Особенности

- **Документоориентированное хранение**: Каждая запись хранится как отдельный JSON-файл
- **Индексирование B-деревом**: Эффективный поиск с поддержкой составных индексов
- **SQL-подобный язык запросов**: Знакомый синтаксис для операций с базой данных
- **Параллельный доступ**: Потокобезопасные операции с механизмами блокировки
- **Отсутствие внешних зависимостей**: Реализация на чистом Python

## Установка

Просто клонируйте этот репозиторий и убедитесь, что у вас установлен Python 3.6+:

```bash
git clone https://github.com/yourusername/json-db.git
cd json-db
```

## Использование

### Интерфейс командной строки

База данных поставляется с интерфейсом командной строки:

```bash
python main.py
```

Это запустит CLI, где вы можете вводить команды:

```
Welcome to JSON DB CLI.
Type 'help' to view available commands or type 'exit' to exit the program.
db> 
```

### Поддерживаемые команды

Поддерживаются следующие SQL-подобные команды:

#### SELECT

Получение документов из коллекции:

```sql
SELECT * FROM users
SELECT name, email FROM users WHERE age=30
```

#### INSERT

Добавление новых документов в коллекцию:

```sql
INSERT INTO users {"name": "John", "email": "john@example.com", "age": 30}
```

#### CREATE INDEX

Создание индексов для более быстрого выполнения запросов:

```sql
CREATE INDEX ON users(name)
CREATE INDEX ON users(age, country)
```

#### UPDATE

Изменение существующих документов:

```sql
UPDATE users SET age=31 WHERE name='John'
```

#### DELETE

Удаление документов из коллекции:

```sql
DELETE FROM users WHERE name='John'
```

## Конфигурация

Конфигурация базы данных определена в начале скрипта:

```python
CONFIG = {
    "data_dir": "./data",
    "btree_degree": 2
}
```

- `data_dir`: Директория, где хранятся файлы данных
- `btree_degree`: Степень B-дерева (определяет размер узла)

## Детали реализации

### Индекс B-дерева

База данных использует структуру данных B-дерево для индексирования, которая обеспечивает эффективный поиск, вставку и запросы по диапазону. Реализация поддерживает:

- Составные индексы (несколько полей)
- Потокобезопасные операции
- Автоматическое обновление индексов

### Коллекции

Коллекции эквивалентны таблицам в традиционных базах данных. Каждая коллекция:

- Хранит документы как отдельные JSON-файлы
- Поддерживает индексы для эффективного выполнения запросов
- Предоставляет операции CRUD (Создание, Чтение, Обновление, Удаление)

### Парсер запросов и Исполнитель

Система запросов включает:

- Парсер, который преобразует SQL-подобный синтаксис в операции
- Исполнитель, который применяет эти операции к коллекциям
- Поддержку условий WHERE с операциями равенства

## Пример использования в качестве библиотеки

Вы также можете использовать JSON DB как библиотеку в вашем Python-коде:

```python
from main import Collection, QueryParser, QueryEngine

# Создание или доступ к коллекции
users = Collection("users", "./data/users")

# Создание индекса
users.create_index(["name", "email"])

# Вставка документа
user_id = users.insert({
    "name": "Alice",
    "email": "alice@example.com",
    "age": 28
})

# Запрос с использованием QueryEngine
engine = QueryEngine("./data")
results = engine.execute(
    QueryParser.parse("SELECT * FROM users WHERE name='Alice'")
)
print(results)
```

## Ограничения

- В условиях WHERE поддерживаются только операции равенства
- Отсутствие поддержки JOINов между коллекциями
- Ограниченная поддержка транзакций (без откатов)
- Простая аутентификация и авторизация
